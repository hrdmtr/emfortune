<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <meta name="description" content="ã‚ãªãŸã®è¨ºæ–­çµæœ: <%= result.personality %>ã€‚<%= result.description.substring(0, 100) %>...">
  <meta property="og:title" content="è¨ºæ–­çµæœ: <%= result.personality %> | EMFortuneå¿ƒç†å ã„">
  <meta property="og:description" content="<%= result.description.substring(0, 100) %>...">
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= typeof baseUrl !== 'undefined' ? baseUrl : 'https://emfortune.onrender.com' %>">
  <meta property="og:image" content="<%= typeof baseUrl !== 'undefined' ? baseUrl : 'https://emfortune.onrender.com' %>/images/ogp-image.png">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="/css/style.css">
  <!-- Google AdSense ã‚³ãƒ¼ãƒ‰ -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3473204146623309" crossorigin="anonymous"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>EMFortune å¿ƒç†å ã„ã‚¢ãƒ—ãƒª</h1>
    </header>
    <main>
      <div class="result-section">
        <h2>è¨ºæ–­çµæœ</h2>
        <div class="result-image">
          <img src="<%= result.image %>" alt="<%= result.personality %>" class="personality-image" onerror="this.onerror=null; this.src='/images/results/default-type.png';">
        </div>
        <div class="result-type">
          <h3><%= result.personality %></h3>
        </div>
        <div class="result-description">
          <p><%= result.description %></p>
        </div>
        <div class="compatibility-section">
          <h3>ä»•äº‹ã¨ã®ç›¸æ€§</h3>
          <p><%= result.workCompatibility %></p>
          
          <h3>äººé–“é–¢ä¿‚ã®ç›¸æ€§</h3>
          <p><%= result.relationshipCompatibility %></p>
        </div>
        <div class="share-section">
          <h3>çµæœã‚’ã‚·ã‚§ã‚¢ã™ã‚‹</h3>
          <div class="share-buttons">
            <a href="https://twitter.com/intent/tweet?text=ç§ã¯ã€Œ<%= result.personality %>ã€ã§ã—ãŸï¼ã‚ãªãŸã‚‚è©¦ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ&url=https://emfortune.onrender.com" target="_blank" class="twitter-share">Twitterã§ã‚·ã‚§ã‚¢</a>
          </div>
        </div>
        
        <div class="like-section">
          <h3>ã“ã®å ã„çµæœã¯ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ</h3>
          <button id="like-button" data-result="<%= result.type %>" class="like-button">
            <span class="like-icon">ğŸ‘</span> 
            <span class="like-text">å½¹ã«ç«‹ã£ãŸï¼</span>
          </button>
          <p class="like-message" id="like-message" style="display: none;"></p>
        </div>
        <div class="retry-button-container">
          <a href="/question" class="retry-button">ã‚‚ã†ä¸€åº¦å ã†</a>
          <button id="create-question-btn" class="create-button">æ–°ã—ã„è³ªå•ã‚’ä½œã‚‹</button>
        </div>
        
        <!-- Google AdSense ãƒ¬ã‚¯ã‚¿ãƒ³ã‚°ãƒ«åºƒå‘Š -->
        <div class="ad-container">
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-3473204146623309"
               data-ad-slot="1234567890"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
      </div>
    </main>
    <footer>
      <p>&copy; 2025 EMFortune</p>
    </footer>
  </div>
  <script src="/js/main.js"></script>
  
  <!-- è³ªå•ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="question-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3 id="modal-title">æ–°ã—ã„è³ªå•ã‚’ä½œæˆ</h3>
      <form id="question-form">
        <!-- è³ªå•ID (hidden) -->
        <input type="hidden" id="question-id" name="id">
        <div class="form-group">
          <label for="question-text">è³ªå•å†…å®¹</label>
          <input type="text" id="question-text" name="text" required>
        </div>
        
        <div class="form-group">
          <label for="share-text">Twitterå…±æœ‰ç”¨ãƒ†ã‚­ã‚¹ãƒˆ</label>
          <input type="text" id="share-text" name="share_text" placeholder="ã“ã®è³ªå•ã‚’Twitterã§ã‚·ã‚§ã‚¢ã™ã‚‹éš›ã®æ–‡è¨€" maxlength="100">
          <p class="field-help">ç©ºæ¬„ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆãŒä½¿ç”¨ã•ã‚Œã¾ã™</p>
        </div>
        
        <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³A -->
        <div class="option-group">
          <h4>é¸æŠè‚¢A</h4>
          <div class="form-group">
            <label for="optionA-text">ãƒ†ã‚­ã‚¹ãƒˆ</label>
            <input type="text" id="optionA-text" name="optionA_text" required>
          </div>
          <div class="form-group">
            <label for="optionA-image">ç”»åƒURL</label>
            <input type="text" id="optionA-image" name="optionA_image" value="/images/option-a.png" required>
          </div>
        </div>
        
        <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³B -->
        <div class="option-group">
          <h4>é¸æŠè‚¢B</h4>
          <div class="form-group">
            <label for="optionB-text">ãƒ†ã‚­ã‚¹ãƒˆ</label>
            <input type="text" id="optionB-text" name="optionB_text" required>
          </div>
          <div class="form-group">
            <label for="optionB-image">ç”»åƒURL</label>
            <input type="text" id="optionB-image" name="optionB_image" value="/images/option-b.png" required>
          </div>
        </div>
        
        <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³C -->
        <div class="option-group">
          <h4>é¸æŠè‚¢C</h4>
          <div class="form-group">
            <label for="optionC-text">ãƒ†ã‚­ã‚¹ãƒˆ</label>
            <input type="text" id="optionC-text" name="optionC_text" required>
          </div>
          <div class="form-group">
            <label for="optionC-image">ç”»åƒURL</label>
            <input type="text" id="optionC-image" name="optionC_image" value="/images/option-c.png" required>
          </div>
        </div>
        
        <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³D -->
        <div class="option-group">
          <h4>é¸æŠè‚¢D</h4>
          <div class="form-group">
            <label for="optionD-text">ãƒ†ã‚­ã‚¹ãƒˆ</label>
            <input type="text" id="optionD-text" name="optionD_text" required>
          </div>
          <div class="form-group">
            <label for="optionD-image">ç”»åƒURL</label>
            <input type="text" id="optionD-image" name="optionD_image" value="/images/option-d.png" required>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="primary-btn">ä¿å­˜</button>
          <button type="button" class="secondary-btn modal-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®CSS -->
  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      width: 90%;
      max-width: 800px;
      max-height: 85vh;
      overflow-y: auto;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .form-group input[type="text"],
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .option-group {
      background-color: #f8f5ff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .primary-btn {
      background-color: #7c4dff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .secondary-btn {
      background-color: #f5f5f5;
      color: #333;
      border: 1px solid #ddd;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .field-help {
      font-size: 0.8rem;
      color: #666;
      margin-top: 5px;
    }
  </style>
  
  <!-- è³ªå•ä½œæˆæ©Ÿèƒ½ã®JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®è¦ç´ 
      const questionModal = document.getElementById('question-modal');
      const createQuestionBtn = document.getElementById('create-question-btn');
      const closeButtons = questionModal.querySelectorAll('.close, .modal-cancel');
      
      // è³ªå•ä½œæˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      if (createQuestionBtn) {
        createQuestionBtn.addEventListener('click', function() {
          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
          document.getElementById('question-form').reset();
          
          // è³ªå•IDã‚’ç©ºã«ã™ã‚‹ï¼ˆæ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ï¼‰
          document.getElementById('question-id').value = '';
          
          // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
          questionModal.style.display = 'block';
        });
      }
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹æ©Ÿèƒ½
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          questionModal.style.display = 'none';
        });
      });
      
      // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      window.addEventListener('click', function(event) {
        if (event.target === questionModal) {
          questionModal.style.display = 'none';
        }
      });
      
      // è³ªå•ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
      const questionForm = document.getElementById('question-form');
      if (questionForm) {
        questionForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // å‰Šé™¤ã‚­ãƒ¼ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‹
          const deleteKey = prompt('è³ªå•ã‚’ä½œæˆãƒ»ç·¨é›†ã™ã‚‹ã«ã¯ä½œæˆã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
          
          // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆ
          if (deleteKey === null) {
            return;
          }
          
          // ä½œæˆã‚­ãƒ¼ã®æ¤œè¨¼ï¼ˆ0618ã«è¨­å®šï¼‰
          if (deleteKey !== '0618') {
            alert('ä½œæˆã‚­ãƒ¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚æ­£ã—ã„ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
          }
          
          // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
          const formData = new FormData(this);
          const questionData = {};
          
          for (const [key, value] of formData.entries()) {
            questionData[key] = value;
          }
          
          // é€ä¿¡ä¸­ã®çŠ¶æ…‹è¡¨ç¤º
          const submitButton = this.querySelector('button[type="submit"]');
          const originalButtonText = submitButton.textContent;
          submitButton.textContent = 'ä¿å­˜ä¸­...';
          submitButton.disabled = true;
          
          // ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡
          fetch('/admin/question', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(questionData)
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ' + response.status);
            }
            return response.json();
          })
          .then(data => {
            if (data.success) {
              // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
              questionModal.style.display = 'none';
              
              // ä¿å­˜æˆåŠŸã®é€šçŸ¥
              alert(data.message);
              
              // æ–°ã—ã„è³ªå•ã‚’é–‹ãã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æä¾›
              if (confirm('æ–°ã—ã„è³ªå•ã‚’è©¦ã—ã¦ã¿ã¾ã™ã‹ï¼Ÿ')) {
                window.location.href = '/question';
              }
            } else {
              throw new Error(data.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
          })
          .catch(error => {
            console.error('è³ªå•ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            alert('è³ªå•ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            
            // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
            submitButton.textContent = originalButtonText;
            submitButton.disabled = false;
          });
        });
      }
    });
  </script>
</body>
</html>